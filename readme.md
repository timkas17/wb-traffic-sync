# WB Tariffs Sync Service üì¶üöÄ

–°–µ—Ä–≤–∏—Å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ Wildberries (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å–∫–ª–∞–¥–æ–≤)  
—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ PostgreSQL –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π —Å Google Sheets.

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è** ‚Äî –µ–∂–µ—á–∞—Å–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Å WB API (`/api/v1/tariffs/box`)
- **Smart Sync** ‚Äî upsert: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –±–µ–∑ –¥—É–±–ª–µ–π
- **Multi-Sheet** ‚Äî –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Google-—Ç–∞–±–ª–∏—Ü (IDs —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞** ‚Äî –∞–≤—Ç–æ-—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
- **Docker-native** ‚Äî –±—ã—Å—Ç—Ä–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ –∏–∑–æ–ª—è—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js (TypeScript)**
- **PostgreSQL + Knex.js** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ query builder
- **Axios** ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å WB API
- **googleapis** ‚Äî —Ä–∞–±–æ—Ç–∞ —Å Google Sheets
- **node-cron** ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
- **Docker, Docker Compose** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1Ô∏è‚É£ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
    ```bash
    git clone <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
    cd <–≤–∞—à-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π>
    ```
2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞**
    ```bash
    cp .env.example .env
    ```
   –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **WB_API_TOKEN** –∏ **GOOGLE_SHEETS_IDS**.                                                                       
   (–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–∏—Å—Ç–æ–≤ "stocks_coefs", –∫–∞–∫ –±—ã–ª–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤ –¢–ó)

3. **–î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Google**
    - –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª `GOOGLE_TOKEN.json` –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (–∏–º–µ–Ω–Ω–æ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º).
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ email —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–∫–∞–∑–∞–Ω–Ω—ã—Ö Google-—Ç–∞–±–ª–∏—Ü.

---

### 2Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

1. **–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫**
    ```bash
    docker compose up --build
    ```

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
   - ‚è≥ **–û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** (Healthcheck)
   - üõ† **–ê–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏–∏** (Knex) –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
   - üîÑ **–ü–µ—Ä–≤–∏—á–Ω—ã–π —Å–∏–Ω–∫** (WB ‚Üí DB ‚Üí Google)
   - üïë **–ó–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞** (`node-cron`) –¥–ª—è –µ–∂–µ—á–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤**
    ```bash
    docker compose logs -f app
    ```

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **`src/`** ‚Äî –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    - **`config/`** ‚Äî –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    - **`postgres/`** ‚Äî
        - `migrations/` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –ë–î (DDL)
        - `seeds/` ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        - `knex.ts` ‚Äî –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Query Builder
    - **`services/`** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (API WB, Google Sheets)
    - **`utils/`** ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    - **`app.ts`** ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- **`Dockerfile`** –∏ **`compose.yaml`** ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ë–î
- **`package.json`** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞
- **`tsconfig.json`**, **`jsconfig.json`** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TypeScript –∏ alias-—ã
- **`google-key.json`** ‚Äî –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Google API

---